<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Calendar Gallery</title>
<meta name="theme-color" content="#0b0b0b" />
<style>
  :root{ --bg:#0b0b0b; --card:#141414; --ink:#e8e8e8; --muted:#bdbdbd; --ring:#2f2f2f; --accent:#dedede; --accent-strong:#ffffff; --accent-ink:#0b0b0b }
  *{box-sizing:border-box}
  html,body{margin:0;padding:0;background:var(--bg);color:var(--ink);font-family:-apple-system,BlinkMacSystemFont,"SF Pro Display",Inter,Roboto,Arial,sans-serif}
  a{color:inherit;text-decoration:none}

  .wrap{max-width:1200px;margin:0 auto;padding:20px}
  header{position:sticky;top:0;z-index:5;display:flex;justify-content:center;align-items:center;padding:14px 0 16px;background:linear-gradient(180deg, rgba(11,11,11,.92), rgba(11,11,11,.72));border-bottom:1px solid var(--ring);backdrop-filter:blur(6px)}
  header h1{margin:0;font-size:20px;color:var(--accent)}

  /* Controls */
  .controls{display:flex;gap:10px;align-items:center;justify-content:space-between;margin-top:16px}
  .left, .right{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
  .btn{display:inline-flex;align-items:center;gap:6px;border:1px solid var(--ring);background:var(--card);color:var(--ink);padding:8px 12px;border-radius:10px;cursor:pointer;font-weight:600;font-size:14px;transition:all .15s ease}
  .btn:hover{border-color:var(--accent);color:var(--accent)}
  .btn[disabled]{opacity:.5;cursor:not-allowed}
  .select{appearance:none;border:1px solid var(--ring);background:var(--card);color:var(--ink);padding:8px 12px;border-radius:10px;font-weight:600}

  /* Calendar */
  .calendar{margin-top:14px;border:1px solid var(--ring);border-radius:16px;background:var(--card);box-shadow:0 2px 8px rgba(0,0,0,.35);overflow:hidden}
  .cal-head{display:grid;grid-template-columns:repeat(7,1fr);border-bottom:1px solid var(--ring);background:linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,0));}
  .cal-head div{padding:10px 8px;text-align:center;font-size:12px;color:var(--muted);font-weight:700;letter-spacing:.4px}

  .grid{display:grid;grid-template-columns:repeat(7,1fr);min-height:420px}
  .cell{position:relative;border-right:1px solid var(--ring);border-bottom:1px solid var(--ring);padding:8px;min-height:112px}
  .grid .cell:nth-child(7n){border-right:none}
  .date-num{font-weight:800;font-size:13px;color:var(--accent);opacity:.9}
  .cell.muted .date-num{color:#9a9a9a}
  .cell.today{outline:2px solid var(--accent);outline-offset:-2px}

  /* Mini slideshow inside day cell (always on) */
  .thumb{margin-top:6px; border:1px solid var(--ring); background:#101010; border-radius:8px; overflow:hidden; position:relative; aspect-ratio:4/3;}
  .thumb .slides{position:absolute; inset:0}
  .thumb .slide{position:absolute; inset:0; opacity:0; transition:opacity .6s ease}
  .thumb .slide.active{opacity:1}
  .thumb img{width:100%;height:100%;object-fit:cover;display:block}
  .count{position:absolute; right:6px; top:6px; background:var(--accent); color:var(--accent-ink); font-weight:800; font-size:11px; padding:2px 6px; border-radius:999px}

  /* Hover preview (bigger) */
  .hover-preview{position:fixed; display:none; z-index:30; pointer-events:none}
  .hover-preview.open{display:block}
  .hover-card{border:1px solid var(--ring); background:#0e0e0e; color:var(--ink); border-radius:12px; overflow:hidden; box-shadow:0 10px 40px rgba(0,0,0,.5)}
  .hover-media{width:360px; height:240px; background:#000; display:flex; align-items:center; justify-content:center}
  .hover-media img{width:100%; height:100%; object-fit:cover}
  .hover-cap{padding:8px 10px; font-size:12px; color:var(--muted); border-top:1px solid var(--ring)}

  /* Drawer for day details */
  .drawer{position:fixed;inset:auto 0 0 0;background:#0e0e0e;border-top:1px solid var(--ring);box-shadow:0 -12px 30px rgba(0,0,0,.45);transform:translateY(100%);transition:transform .25s ease;z-index:20}
  .drawer.open{transform:translateY(0)}
  .drawer .bar{display:flex;justify-content:space-between;align-items:center;padding:12px 16px;border-bottom:1px solid var(--ring);background:#121212}
  .drawer .bar h2{margin:0;font-size:16px;color:var(--accent)}
  .drawer .close{border:1px solid var(--ring);background:#151515;color:var(--ink);padding:6px 10px;border-radius:8px;cursor:pointer}
  .drawer .body{padding:16px}

  .photos{display:grid;grid-template-columns:1fr;gap:24px;max-width:900px;margin:0 auto}
  @media(min-width:900px){.photos{display:grid;grid-template-columns:1fr;gap:24px;max-width:900px;margin:0 auto}}
  .card{border:1px solid var(--ring);background:#121212;border-radius:14px;overflow:hidden}
  .card .media{aspect-ratio:3/4;background:#0d0d0d;border-bottom:1px solid var(--ring);display:flex;align-items:center;justify-content:center}
  .card img{width:100%;height:100%;object-fit:cover;display:block}
  .card .cap{padding:10px 12px;font-size:13px;color:var(--muted)}

  /* Modal backdrop for image focus */
  .modal{position:fixed;inset:0;background:rgba(0,0,0,.72);display:none;align-items:center;justify-content:center;z-index:40}
  .modal.open{display:flex}
  .modal .frame{max-width:92vw;max-height:88vh;border-radius:12px;overflow:hidden;border:1px solid var(--ring);background:#000}
  .modal img{max-width:100%;max-height:88vh;display:block}

  .sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0}
</style>
</head>
<body>
  <div class="wrap">
    <header><h1>Calendar Gallery</h1></header>

    <div class="controls" role="group" aria-label="Calendar controls">
      <div class="left">
        <button class="btn" id="prevMonth" aria-label="Previous month">◀</button>
        <button class="btn" id="todayBtn">Today</button>
        <button class="btn" id="nextMonth" aria-label="Next month">▶</button>
      </div>
      <div class="right">
        <select id="monthSel" class="select" aria-label="Month"></select>
        <select id="yearSel" class="select" aria-label="Year"></select>
      </div>
    </div>

    <section class="calendar" aria-label="Calendar">
      <div class="cal-head" id="weekdayHead"></div>
      <div class="grid" id="grid"></div>
    </section>

    <!-- Simple HTML data: edit here. Each section is one day. -->
    <div id="data" class="sr-only">
      <!-- Example day with photos -->
      <section data-date="2025-09-05">
        <figure>
          <img src="./foto/uno.png" alt="Mimì with cap" />
          <figcaption>Real smile, zero sleep</figcaption>
        </figure>
        <figure>
          <img src="./foto/due.png" alt="Friends cheering" />
          <figcaption>Crowd control: none</figcaption>
        </figure>
      </section>
      <section data-date="2025-09-04">
        <figure>
          <img src="./foto/tre.png" alt="Rehearsal coffee" />
          <figcaption>Powered by caffeine</figcaption>
        </figure>
      </section>
    </div>
  </div>

  <!-- Hover preview root -->
  <div class="hover-preview" id="hoverPreview" aria-hidden="true">
    <div class="hover-card">
      <div class="hover-media"><img id="hoverImg" alt="" /></div>
      <div class="hover-cap" id="hoverCap"></div>
    </div>
  </div>

  <!-- Drawer for selected day -->
  <aside class="drawer" id="drawer" aria-hidden="true" aria-label="Day details">
    <div class="bar">
      <h2 id="drawerTitle">—</h2>
      <button class="close" id="closeDrawer" aria-label="Close">Close</button>
    </div>
    <div class="body">
      <div class="photos" id="photoGrid"></div>
    </div>
  </aside>

  <!-- Image modal -->
  <div class="modal" id="modal" role="dialog" aria-modal="true" aria-label="Image">
    <div class="frame"><img id="modalImg" alt="" /></div>
  </div>

<script>
  // ======== CONFIG ========
  const RANGE = { startYear: 2019, endYear: 2025 };
  const WEEK_START = 1; // 0=Sunday, 1=Monday

  // ======== STATE ========
  let view = todayYM(); // {y,m}
  let data = readFromHTML(); // { 'YYYY-MM-DD': [ {src, description} ] }

  // Hover preview state
  let hoverTimer = null; // for hover preview slideshow
  let hoverIndex = 0;
  let hoverList = [];
  const cellTimers = []; // per-cell slideshow intervals

  // ======== ELEMENTS ========
  const elWeekHead = document.getElementById('weekdayHead');
  const elGrid     = document.getElementById('grid');
  const monthSel   = document.getElementById('monthSel');
  const yearSel    = document.getElementById('yearSel');
  const prevBtn    = document.getElementById('prevMonth');
  const nextBtn    = document.getElementById('nextMonth');
  const todayBtn   = document.getElementById('todayBtn');

  const drawer     = document.getElementById('drawer');
  const drawerTitle= document.getElementById('drawerTitle');
  const photoGrid  = document.getElementById('photoGrid');
  const closeDrawer= document.getElementById('closeDrawer');
  const modal      = document.getElementById('modal');
  const modalImg   = document.getElementById('modalImg');

  const hoverPreview = document.getElementById('hoverPreview');
  const hoverImg     = document.getElementById('hoverImg');
  const hoverCap     = document.getElementById('hoverCap');

  // ======== INIT ========
  renderWeekHead();
  initSelectors();
  renderCalendar();

  // ======== RENDER ========
  function renderWeekHead(){
    const fmt = new Intl.DateTimeFormat('en-GB',{weekday:'short'});
    const base = new Date(2024,0,7); // Monday
    elWeekHead.innerHTML = '';
    for (let i=0;i<7;i++){
      const d = new Date(base.getTime());
      d.setDate(base.getDate() + ((i + WEEK_START) % 7));
      const cell = document.createElement('div');
      cell.textContent = fmt.format(d).toUpperCase();
      elWeekHead.appendChild(cell);
    }
  }

  function initSelectors(){
    // Months
    const mFmtFull = new Intl.DateTimeFormat('en-GB',{month:'long'});
    monthSel.innerHTML = '';
    for (let m=0;m<12;m++){
      const opt = document.createElement('option');
      opt.value = m; opt.textContent = mFmtFull.format(new Date(2024,m,1));
      monthSel.appendChild(opt);
    }
    // Years
    yearSel.innerHTML = '';
    for (let y=RANGE.startYear; y<=RANGE.endYear; y++){
      const opt = document.createElement('option');
      opt.value = y; opt.textContent = y; yearSel.appendChild(opt);
    }
    // Set current
    monthSel.value = view.m; yearSel.value = view.y;

    // Events
    monthSel.addEventListener('change', () => { view.m = parseInt(monthSel.value,10); renderCalendar(); });
    yearSel.addEventListener('change',  () => { view.y = parseInt(yearSel.value,10); renderCalendar(); });
    prevBtn.addEventListener('click',   () => { shiftMonth(-1); });
    nextBtn.addEventListener('click',   () => { shiftMonth(1); });
    todayBtn.addEventListener('click',  () => { view = todayYM(); monthSel.value = view.m; yearSel.value = view.y; renderCalendar(); });
  }

  function renderCalendar(){
    // clear old per-cell intervals
    while (cellTimers.length){ clearInterval(cellTimers.pop()); }

    const {y,m} = view;
    elGrid.innerHTML = '';

    const first = new Date(y, m, 1);
    const startOffset = mod((first.getDay() - WEEK_START), 7);
    const startDate = new Date(first.getTime());
    startDate.setDate(1 - startOffset); // grid starts on this date

    const today = new Date(); const tY=today.getFullYear(), tM=today.getMonth(), tD=today.getDate();

    for (let i=0;i<42;i++){ // 6 weeks grid
      const d = new Date(startDate.getTime()); d.setDate(startDate.getDate()+i);
      const iso = toISO(d);
      const inMonth = d.getMonth() === m;
      const cell = document.createElement('div'); cell.className = 'cell' + (inMonth?'':' muted');
      if (d.getFullYear()===tY && d.getMonth()===tM && d.getDate()===tD) cell.classList.add('today');

      const head = document.createElement('div'); head.className = 'date-num'; head.textContent = d.getDate(); cell.appendChild(head);

      const dayEvents = data[iso] || [];
      if (dayEvents.length){
        const thumb = document.createElement('div'); thumb.className='thumb';
        const slides = document.createElement('div'); slides.className='slides'; thumb.appendChild(slides);
        dayEvents.forEach((ev, idx) => {
          const im = document.createElement('img'); im.src = ev.src; im.alt = ev.description || '';
          im.className = 'slide' + (idx===0 ? ' active' : '');
          slides.appendChild(im);
        });
        // removed badge count
        cell.appendChild(thumb);

        // Always-on in-cell slideshow with fade every 3s
        if (dayEvents.length > 1){
          let idx = 0;
          const imgs = Array.from(slides.querySelectorAll('.slide'));
          const timer = setInterval(() => {
            imgs[idx].classList.remove('active');
            idx = (idx + 1) % imgs.length;
            imgs[idx].classList.add('active');
          }, 3000);
          cellTimers.push(timer);
        }

        // Bigger hover preview
        cell.addEventListener('mouseenter', () => openHoverPreview(cell, iso));
        cell.addEventListener('mouseleave', closeHoverPreview);

        // Click to open drawer with ALL photos
        cell.addEventListener('click', () => openDrawer(iso));
      }

      elGrid.appendChild(cell);
    }
  }

  // ======== HOVER PREVIEW ========
  function openHoverPreview(cell, iso){
    const list = data[iso] || []; if (!list.length) return;
    hoverList = list; hoverIndex = 0;
    hoverImg.src = list[0].src; hoverImg.alt = list[0].description || '';
    hoverCap.textContent = list[0].description || '';

    const r = cell.getBoundingClientRect();
    const pad = 8; const cardW = 360; const cardH = 280;
    let x = r.left + window.scrollX + r.width + pad;
    let y = r.top  + window.scrollY - (cardH - r.height)/2;
    if (x + cardW > window.scrollX + window.innerWidth - 8) x = r.left + window.scrollX - cardW - pad;
    y = Math.max(window.scrollY + 8, Math.min(y, window.scrollY + window.innerHeight - cardH - 8));

    hoverPreview.style.left = x + 'px';
    hoverPreview.style.top  = y + 'px';
    hoverPreview.classList.add('open');
    hoverPreview.setAttribute('aria-hidden','false');

    // slideshow in preview every 3s
    stopHoverTimer();
    if (list.length > 1){
      hoverTimer = setInterval(() => {
        hoverIndex = (hoverIndex + 1) % list.length;
        hoverImg.src = list[hoverIndex].src; hoverImg.alt = list[hoverIndex].description || '';
        hoverCap.textContent = list[hoverIndex].description || '';
      }, 3000);
    }
  }
  function closeHoverPreview(){
    stopHoverTimer();
    hoverPreview.classList.remove('open');
    hoverPreview.setAttribute('aria-hidden','true');
  }
  function stopHoverTimer(){ if (hoverTimer){ clearInterval(hoverTimer); hoverTimer=null; } }

  // ======== DRAWER & MODAL ========
  function openDrawer(iso){
    closeHoverPreview();
    const d = toDate(iso);
    drawerTitle.textContent = d.toLocaleDateString('en-GB',{ weekday:'long', day:'2-digit', month:'long', year:'numeric' });
    photoGrid.innerHTML = '';

    const list = data[iso] || [];
    if (!list.length){
      photoGrid.innerHTML = `<p style="color:var(--muted)">No photos for this day. Add them in the <code>#data</code> block.</p>`;
    } else {
      list.forEach(item => {
        const card = document.createElement('article'); card.className='card';
        const media = document.createElement('div'); media.className='media';
        const img = document.createElement('img'); img.src=item.src; img.alt=item.description||'';
        img.addEventListener('click', () => openModal(item.src, item.description||''));
        media.appendChild(img);
        const cap = document.createElement('div'); cap.className='cap'; cap.textContent = item.description || '';
        card.appendChild(media); card.appendChild(cap); photoGrid.appendChild(card);
      });
    }

    drawer.classList.add('open'); drawer.setAttribute('aria-hidden','false');
  }

  function closeDrawerFn(){ drawer.classList.remove('open'); drawer.setAttribute('aria-hidden','true'); }
  document.getElementById('closeDrawer').addEventListener('click', closeDrawerFn);
  window.addEventListener('keydown', e=>{ if(e.key==='Escape'){ if(modal.classList.contains('open')) closeModal(); else if(drawer.classList.contains('open')) closeDrawerFn(); } });

  function openModal(src, alt){ modalImg.src=src; modalImg.alt=alt; modal.classList.add('open'); }
  function closeModal(){ modal.classList.remove('open'); modalImg.src=''; modalImg.alt=''; }
  document.getElementById('modal').addEventListener('click', e=>{ const m = document.getElementById('modal'); if(e.target===m) closeModal(); });

  // ======== NAV UTILS ========
  function shiftMonth(step){
    let y=view.y, m=view.m + step;
    if (m<0){ m=11; y--; } else if (m>11){ m=0; y++; }
    if (y<RANGE.startYear || y>RANGE.endYear) return;
    view={y,m}; monthSel.value=m; yearSel.value=y; renderCalendar();
  }

  // ======== DATA LOADING (from HTML) ========
  function readFromHTML(){
    const root = document.getElementById('data');
    const out = {};
    if (!root) return out;
    root.querySelectorAll('section[data-date]')?.forEach(sec => {
      const date = sec.getAttribute('data-date');
      const figs = sec.querySelectorAll('figure');
      figs.forEach(fig => {
        const img = fig.querySelector('img');
        const cap = fig.querySelector('figcaption');
        if (!img) return;
        (out[date] ||= []).push({ src: img.getAttribute('src') || '', description: (cap?.textContent||'').trim() });
      });
    });
    return out;
  }

  // ======== HELPERS ========
  function toISO(d){ return new Date(d).toISOString().slice(0,10); }
  function toDate(iso){ return new Date(iso+'T12:00:00'); }
  function mod(a,b){ return (a%b + b)%b; }
  function todayYM(){ const t=new Date(); return { y:t.getFullYear(), m:t.getMonth() }; }
</script>
</body>
</html>
